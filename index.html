<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>COMBRIDGE&EB お年玉くじ</title>

  <style>
    body {
      text-align: center;
      font-family: "Hiragino Maru Gothic Pro", sans-serif;
      background: linear-gradient(to bottom, #fff5f5, #ffe6cc);
      padding: 30px;
    }

    h2 {
      color: #d00000;
      font-size: 36px;
    }

    input {
      width: 220px;
      padding: 8px;
      margin: 6px;
      border-radius: 10px;
      border: 2px solid #d00000;
    }

    button {
      background: #d00000;
      color: white;
      padding: 10px 20px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
    }

    #resultText {
      font-size: 28px;
      color: #d00000;
      margin-top: 20px;
      display: none;
    }
  </style>
</head>

<body>

<h2>COMBRIDGE&EB<br>お年玉くじ</h2>

<!-- 名前入力 -->
<input id="name" type="text" placeholder="名前"><br>

<button id="drawButton" onclick="draw()">くじを引く</button>

<p id="resultText"></p>

<!-- 当たり専用：メール入力（最初は非表示） -->
<div id="emailArea" style="display:none;">
  <input id="email" type="email" placeholder="メールアドレス"><br>
  <button onclick="sendEmail()">登録</button>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwDrwRaCGQAv9xXiHTfd60D0KyNZSdiSfayo8EIosj9GW3Kbid_REVePMpEH35eV2TNEQ/exec";
let userName = "";

async function draw() {
  const name = document.getElementById("name").value;
  if (!name) {
    alert("名前を入力してください");
    return;
  }

  userName = name;

  document.getElementById("drawButton").style.display = "none";
  document.getElementById("name").style.display = "none";

  const res = await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      mode: "draw",
      name: name
    })
  });

  const data = await res.json();

  const resultText = document.getElementById("resultText");
  resultText.style.display = "block";
  resultText.innerHTML = "＼ " + data.result + " ／<br>" + data.prize;

  // ▼ 当たりのときだけメール入力を表示
  if (data.result === "あたり") {
    document.getElementById("emailArea").style.display = "block";
  }
}

async function sendEmail() {
  const email = document.getElementById("email").value;
  if (!email) {
    alert("メールアドレスを入力してください");
    return;
  }

  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      mode: "saveEmail",
      name: userName,
      email: email
    })
  });

  alert("メールアドレスを登録しました！");
  document.getElementById("emailArea").style.display = "none";
}
</script>

</body>
</html>
